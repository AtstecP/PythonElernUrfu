import csv
import xml.etree.ElementTree as ET
import pandas as pd
import requests
from datetime import datetime, timedelta
from PrintOrCreate import DataSet


def main():
    """
    Вызывает метод чтения, затем убирает лишнии валюты и вызывает метод записи
    """

    name = 'vacancies_dif_currencies.csv'
    min_date, max_date, dict_currency, dataframe = parser_csv(name)
    # print(dataframe)
    dict_currencies_new = {'date': None}
    for key in dict_currency.keys():
        if dict_currency[key] > 5000:
            dict_currencies_new[key] = dict_currency[key]
    dict_currencies_new.pop('')
    data_currency = create_csv(dict_currencies_new, min_date, max_date)
    # data_currency = {'2003-01': {'USD': 31.7844, 'RUR': 1, 'EUR': 33.2719, 'KZT': 0.203925, 'UAH': 5.9418999999999995, 'BYR': 0.0164252}, '2003-02': {'USD': 31.8345, 'RUR': 1, 'EUR': 34.429, 'KZT': 0.205576, 'UAH': 5.94182, 'BYR': 0.0162562}, '2003-03': {'USD': 31.5729, 'RUR': 1, 'EUR': 33.9409, 'KZT': 0.20819400000000002, 'UAH': 5.89454, 'BYR': 0.015988699999999998}, '2003-04': {'USD': 31.3801, 'RUR': 1, 'EUR': 33.9815, 'KZT': 0.206202, 'UAH': 5.85471, 'BYR': 0.0156963}, '2003-05': {'USD': 31.1021, 'RUR': 1, 'EUR': 34.5513, 'KZT': 0.204875, 'UAH': 5.77205, 'BYR': 0.015331}, '2003-06': {'USD': 30.709, 'RUR': 1, 'EUR': 36.4669, 'KZT': 0.204125, 'UAH': 5.63882, 'BYR': 0.0150078}, '2003-07': {'USD': 30.3809, 'RUR': 1, 'EUR': 34.7223, 'KZT': 0.205946, 'UAH': 5.64921, 'BYR': 0.0147152}, '2003-08': {'USD': 30.2791, 'RUR': 1, 'EUR': 34.3395, 'KZT': 0.20635799999999999, 'UAH': 5.64751, 'BYR': 0.014570399999999999}, '2003-09': {'USD': 30.5036, 'RUR': 1, 'EUR': 33.2001, 'KZT': 0.206829, 'UAH': 5.67055, 'BYR': 0.014517200000000001}, '2003-10': {'USD': 30.6142, 'RUR': 1, 'EUR': 35.6043, 'KZT': 0.205656, 'UAH': 5.6789700000000005, 'BYR': 0.0144789}, '2003-11': {'USD': 29.9451, 'RUR': 1, 'EUR': 34.7992, 'KZT': 0.20292300000000002, 'UAH': 5.5546500000000005, 'BYR': 0.0140383}, '2003-12': {'USD': 29.7387, 'RUR': 1, 'EUR': 35.5021, 'KZT': 0.202809, 'UAH': 5.51687, 'BYR': 0.0138432}, '2004-01': {'USD': 29.4545, 'RUR': 1, 'EUR': 37.0979, 'KZT': 0.20567, 'UAH': 5.474, 'BYR': 0.013575100000000001}, '2004-02': {'USD': 28.4937, 'RUR': 1, 'EUR': 35.3635, 'KZT': 0.204323, 'UAH': 5.27896, 'BYR': 0.0131915}, '2004-03': {'USD': 28.5156, 'RUR': 1, 'EUR': 35.5076, 'KZT': 0.20509799999999997, 'UAH': 5.2939, 'BYR': 0.0132329}, '2004-04': {'USD': 28.5151, 'RUR': 1, 'EUR': 34.9082, 'KZT': 0.205346, 'UAH': 5.2941, 'BYR': 0.013260999999999998}, '2004-05': {'USD': 28.9612, 'RUR': 1, 'EUR': 34.6289, 'KZT': 0.209668, 'UAH': 5.40129, 'BYR': 0.0134213}, '2004-06': {'USD': 28.9993, 'RUR': 1, 'EUR': 35.3907, 'KZT': 0.21172000000000002, 'UAH': 5.43363, 'BYR': 0.013446}, '2004-07': {'USD': 29.0471, 'RUR': 1, 'EUR': 35.0889, 'KZT': 0.21367899999999998, 'UAH': 5.443, 'BYR': 0.0134428}, '2004-08': {'USD': 29.1019, 'RUR': 1, 'EUR': 35.0532, 'KZT': 0.213478, 'UAH': 5.455, 'BYR': 0.013455199999999999}, '2004-09': {'USD': 29.2591, 'RUR': 1, 'EUR': 35.3713, 'KZT': 0.21452100000000002, 'UAH': 5.47267, 'BYR': 0.0135205}, '2004-10': {'USD': 29.2224, 'RUR': 1, 'EUR': 36.0312, 'KZT': 0.217488, 'UAH': 5.43157, 'BYR': 0.0134572}, '2004-11': {'USD': 28.7655, 'RUR': 1, 'EUR': 36.6472, 'KZT': 0.217885, 'UAH': 5.34595, 'BYR': 0.013208399999999999}, '2004-12': {'USD': 28.1496, 'RUR': 1, 'EUR': 37.3264, 'KZT': 0.21645199999999998, 'UAH': 5.25728, 'BYR': 0.0128957}, '2005-01': {'USD': 27.7487, 'RUR': 1, 'EUR': 37.8409, 'KZT': 0.21343800000000002, 'UAH': 5.1233699999999995, 'BYR': 0.0127492}, '2005-02': {'USD': 28.1136, 'RUR': 1, 'EUR': 36.5899, 'KZT': 0.216228, 'UAH': 5.28382, 'BYR': 0.0129161}, '2005-03': {'USD': 27.7007, 'RUR': 1, 'EUR': 36.72, 'KZT': 0.212837, 'UAH': 5.22822, 'BYR': 0.0128099}, '2005-04': {'USD': 27.8548, 'RUR': 1, 'EUR': 36.0274, 'KZT': 0.21023499999999998, 'UAH': 5.32108, 'BYR': 0.0129155}, '2005-05': {'USD': 27.7726, 'RUR': 1, 'EUR': 36.0072, 'KZT': 0.211391, 'UAH': 5.46974, 'BYR': 0.012898699999999999}, '2005-06': {'USD': 28.1946, 'RUR': 1, 'EUR': 34.9134, 'KZT': 0.21324, 'UAH': 5.5555900000000005, 'BYR': 0.0131016}, '2005-07': {'USD': 28.6282, 'RUR': 1, 'EUR': 34.6258, 'KZT': 0.21209, 'UAH': 5.67558, 'BYR': 0.013303800000000001}, '2005-08': {'USD': 28.6341, 'RUR': 1, 'EUR': 34.716, 'KZT': 0.210728, 'UAH': 5.6852, 'BYR': 0.0133166}, '2005-09': {'USD': 28.5566, 'RUR': 1, 'EUR': 34.879, 'KZT': 0.211038, 'UAH': 5.65612, 'BYR': 0.0132644}, '2005-10': {'USD': 28.5348, 'RUR': 1, 'EUR': 34.3074, 'KZT': 0.213347, 'UAH': 5.59429, 'BYR': 0.0132558}, '2005-11': {'USD': 28.503, 'RUR': 1, 'EUR': 34.3946, 'KZT': 0.212574, 'UAH': 5.54059, 'BYR': 0.0132476}, '2005-12': {'USD': 28.7792, 'RUR': 1, 'EUR': 33.9393, 'KZT': 0.21463100000000002, 'UAH': 5.66375, 'BYR': 0.013381800000000001}, '2006-01': {'USD': 28.7825, 'RUR': 1, 'EUR': 34.185, 'KZT': 0.215337, 'UAH': 5.67232, 'BYR': 0.013363400000000001}, '2006-02': {'USD': 28.1305, 'RUR': 1, 'EUR': 34.0492, 'KZT': 0.213002, 'UAH': 5.49284, 'BYR': 0.0130756}, '2006-03': {'USD': 28.1211, 'RUR': 1, 'EUR': 33.3291, 'KZT': 0.215807, 'UAH': 5.50315, 'BYR': 0.0130665}, '2006-04': {'USD': 27.6996, 'RUR': 1, 'EUR': 33.6273, 'KZT': 0.215729, 'UAH': 5.42258, 'BYR': 0.0128746}, '2006-05': {'USD': 27.2739, 'RUR': 1, 'EUR': 34.1906, 'KZT': 0.21917, 'UAH': 5.37279, 'BYR': 0.0126848}, '2006-06': {'USD': 26.9355, 'RUR': 1, 'EUR': 34.7064, 'KZT': 0.222155, 'UAH': 5.3830100000000005, 'BYR': 0.0125603}, '2006-07': {'USD': 26.9423, 'RUR': 1, 'EUR': 34.2383, 'KZT': 0.22770700000000002, 'UAH': 5.34824, 'BYR': 0.012571500000000001}, '2006-08': {'USD': 26.8197, 'RUR': 1, 'EUR': 34.2112, 'KZT': 0.22661, 'UAH': 5.32, 'BYR': 0.0125158}, '2006-09': {'USD': 26.7295, 'RUR': 1, 'EUR': 34.318, 'KZT': 0.213213, 'UAH': 5.290979999999999, 'BYR': 0.012478}, '2006-10': {'USD': 26.7799, 'RUR': 1, 'EUR': 33.9783, 'KZT': 0.21049199999999998, 'UAH': 5.29896, 'BYR': 0.012505200000000001}, '2006-11': {'USD': 26.7811, 'RUR': 1, 'EUR': 33.9852, 'KZT': 0.209511, 'UAH': 5.28414, 'BYR': 0.0125036}, '2006-12': {'USD': 26.3081, 'RUR': 1, 'EUR': 34.6899, 'KZT': 0.205628, 'UAH': 5.20303, 'BYR': 0.0122874}, '2007-01': {'USD': 26.3311, 'RUR': 1, 'EUR': 34.6965, 'KZT': 0.207609, 'UAH': 5.21987, 'BYR': 0.012290599999999999}, '2007-02': {'USD': 26.5484, 'RUR': 1, 'EUR': 34.3802, 'KZT': 0.21032299999999998, 'UAH': 5.23823, 'BYR': 0.0123467}, '2007-03': {'USD': 26.1481, 'RUR': 1, 'EUR': 34.539, 'KZT': 0.21000800000000003, 'UAH': 5.16567, 'BYR': 0.0121718}, '2007-04': {'USD': 26.0113, 'RUR': 1, 'EUR': 34.6861, 'KZT': 0.210061, 'UAH': 5.13966, 'BYR': 0.0121237}, '2007-05': {'USD': 25.6851, 'RUR': 1, 'EUR': 35.0653, 'KZT': 0.213842, 'UAH': 5.082330000000001, 'BYR': 0.011947900000000001}, '2007-06': {'USD': 25.9043, 'RUR': 1, 'EUR': 34.8128, 'KZT': 0.211337, 'UAH': 5.13709, 'BYR': 0.012049200000000001}, '2007-07': {'USD': 25.8162, 'RUR': 1, 'EUR': 34.715, 'KZT': 0.21101099999999998, 'UAH': 5.11465, 'BYR': 0.0120187}, '2007-08': {'USD': 25.5448, 'RUR': 1, 'EUR': 35.0015, 'KZT': 0.206631, 'UAH': 5.07778, 'BYR': 0.0118917}, '2007-09': {'USD': 25.6262, 'RUR': 1, 'EUR': 35.0233, 'KZT': 0.202803, 'UAH': 5.095280000000001, 'BYR': 0.011914300000000001}, '2007-10': {'USD': 24.9493, 'RUR': 1, 'EUR': 35.3457, 'KZT': 0.206255, 'UAH': 4.95517, 'BYR': 0.011601}, '2007-11': {'USD': 24.6724, 'RUR': 1, 'EUR': 35.6492, 'KZT': 0.204098, 'UAH': 4.877129999999999, 'BYR': 0.011457499999999999}, '2007-12': {'USD': 24.4171, 'RUR': 1, 'EUR': 36.0055, 'KZT': 0.20202, 'UAH': 4.81239, 'BYR': 0.0113252}, '2008-01': {'USD': 24.5462, 'RUR': 1, 'EUR': 35.9332, 'KZT': 0.203492, 'UAH': 4.82357, 'BYR': 0.011389699999999999}, '2008-02': {'USD': 24.4262, 'RUR': 1, 'EUR': 36.29, 'KZT': 0.203185, 'UAH': 4.7900100000000005, 'BYR': 0.0113498}, '2008-03': {'USD': 24.0023, 'RUR': 1, 'EUR': 36.5099, 'KZT': 0.198601, 'UAH': 4.70975, 'BYR': 0.011176199999999999}, '2008-04': {'USD': 23.5027, 'RUR': 1, 'EUR': 37.0873, 'KZT': 0.194725, 'UAH': 4.66203, 'BYR': 0.010944200000000001}, '2008-05': {'USD': 23.6588, 'RUR': 1, 'EUR': 36.8959, 'KZT': 0.19649899999999998, 'UAH': 4.73583, 'BYR': 0.0110478}, '2008-06': {'USD': 23.7384, 'RUR': 1, 'EUR': 36.7827, 'KZT': 0.196848, 'UAH': 4.93501, 'BYR': 0.0111144}, '2008-07': {'USD': 23.4068, 'RUR': 1, 'EUR': 36.971, 'KZT': 0.193826, 'UAH': 4.96359, 'BYR': 0.011014300000000001}, '2008-08': {'USD': 23.4186, 'RUR': 1, 'EUR': 36.5752, 'KZT': 0.19483, 'UAH': 5.01576, 'BYR': 0.0110752}, '2008-09': {'USD': 24.5769, 'RUR': 1, 'EUR': 36.2264, 'KZT': 0.20550999999999997, 'UAH': 5.285349999999999, 'BYR': 0.0116368}, '2008-10': {'USD': 25.3718, 'RUR': 1, 'EUR': 36.4999, 'KZT': 0.211555, 'UAH': 5.0052900000000005, 'BYR': 0.0120046}, '2008-11': {'USD': 27.0981, 'RUR': 1, 'EUR': 34.4092, 'KZT': 0.226138, 'UAH': 4.52767, 'BYR': 0.0128214}, '2008-12': {'USD': 27.606, 'RUR': 1, 'EUR': 35.7166, 'KZT': 0.22933299999999998, 'UAH': 3.74319, 'BYR': 0.012888}, '2009-01': {'USD': 29.3916, 'RUR': 1, 'EUR': 41.4275, 'KZT': 0.242475, 'UAH': 3.82952, 'BYR': 0.0133537}, '2009-02': {'USD': 35.4146, 'RUR': 1, 'EUR': 45.6636, 'KZT': 0.290212, 'UAH': 4.5564, 'BYR': 0.013005699999999999}, '2009-03': {'USD': 35.7205, 'RUR': 1, 'EUR': 45.3543, 'KZT': 0.23705400000000001, 'UAH': 4.2024099999999995, 'BYR': 0.0125291}, '2009-04': {'USD': 33.9032, 'RUR': 1, 'EUR': 44.8946, 'KZT': 0.224651, 'UAH': 4.21158, 'BYR': 0.011946199999999999}, '2009-05': {'USD': 32.974, 'RUR': 1, 'EUR': 43.9939, 'KZT': 0.21861, 'UAH': 4.060840000000001, 'BYR': 0.0116681}, '2009-06': {'USD': 30.9843, 'RUR': 1, 'EUR': 43.378, 'KZT': 0.205889, 'UAH': 4.05288, 'BYR': 0.0111214}, '2009-07': {'USD': 31.0385, 'RUR': 1, 'EUR': 43.8512, 'KZT': 0.206222, 'UAH': 4.05732, 'BYR': 0.0109368}, '2009-08': {'USD': 31.1533, 'RUR': 1, 'EUR': 43.9978, 'KZT': 0.20668299999999998, 'UAH': 3.8796100000000004, 'BYR': 0.010931}, '2009-09': {'USD': 31.8397, 'RUR': 1, 'EUR': 45.4321, 'KZT': 0.211097, 'UAH': 3.7657800000000003, 'BYR': 0.011266700000000001}, '2009-10': {'USD': 30.0087, 'RUR': 1, 'EUR': 43.8877, 'KZT': 0.198812, 'UAH': 3.60898, 'BYR': 0.0108531}, '2009-11': {'USD': 29.0488, 'RUR': 1, 'EUR': 43.0678, 'KZT': 0.19267600000000001, 'UAH': 3.5339199999999997, 'BYR': 0.0105863}, '2009-12': {'USD': 29.0687, 'RUR': 1, 'EUR': 43.7658, 'KZT': 0.195486, 'UAH': 3.6267899999999997, 'BYR': 0.0104451}, '2010-01': {'USD': 30.1851, 'RUR': 1, 'EUR': 43.4605, 'KZT': 0.20323899999999998, 'UAH': 3.7497, 'BYR': 0.0105395}, '2010-02': {'USD': 30.4312, 'RUR': 1, 'EUR': 42.4637, 'KZT': 0.205686, 'UAH': 3.7896900000000002, 'BYR': 0.010540800000000001}, '2010-03': {'USD': 29.9484, 'RUR': 1, 'EUR': 40.8047, 'KZT': 0.203281, 'UAH': 3.7332799999999997, 'BYR': 0.0102178}, '2010-04': {'USD': 29.4956, 'RUR': 1, 'EUR': 39.5713, 'KZT': 0.20069099999999998, 'UAH': 3.6999000000000004, 'BYR': 0.009901199999999999}, '2010-05': {'USD': 29.1537, 'RUR': 1, 'EUR': 38.6986, 'KZT': 0.199042, 'UAH': 3.65885, 'BYR': 0.0098426}, '2010-06': {'USD': 30.74, 'RUR': 1, 'EUR': 37.8133, 'KZT': 0.209579, 'UAH': 3.8788600000000004, 'BYR': 0.0102433}, '2010-07': {'USD': 31.2554, 'RUR': 1, 'EUR': 38.2097, 'KZT': 0.21180800000000002, 'UAH': 3.94569, 'BYR': 0.0103529}, '2010-08': {'USD': 30.1869, 'RUR': 1, 'EUR': 39.4694, 'KZT': 0.20435199999999998, 'UAH': 3.82316, 'BYR': 0.0101434}, '2010-09': {'USD': 30.8669, 'RUR': 1, 'EUR': 39.0127, 'KZT': 0.20948699999999998, 'UAH': 3.91364, 'BYR': 0.0102446}, '2010-10': {'USD': 30.5126, 'RUR': 1, 'EUR': 41.4392, 'KZT': 0.206746, 'UAH': 3.8438600000000003, 'BYR': 0.010133699999999999}, '2010-11': {'USD': 30.7821, 'RUR': 1, 'EUR': 42.7256, 'KZT': 0.20864999999999997, 'UAH': 3.87172, 'BYR': 0.0102198}, '2010-12': {'USD': 31.3335, 'RUR': 1, 'EUR': 41.0814, 'KZT': 0.212229, 'UAH': 3.93316, 'BYR': 0.010334300000000001}, '2011-01': {'USD': 30.3505, 'RUR': 1, 'EUR': 40.4876, 'KZT': 0.20582899999999998, 'UAH': 3.80929, 'BYR': 0.010113500000000001}, '2011-02': {'USD': 29.8018, 'RUR': 1, 'EUR': 40.5811, 'KZT': 0.20271999999999998, 'UAH': 3.75101, 'BYR': 0.0098944}, '2011-03': {'USD': 28.9028, 'RUR': 1, 'EUR': 39.8136, 'KZT': 0.197992, 'UAH': 3.6412999999999998, 'BYR': 0.009561}, '2011-04': {'USD': 28.5162, 'RUR': 1, 'EUR': 40.3875, 'KZT': 0.19567199999999998, 'UAH': 3.57682, 'BYR': 0.00936185}, '2011-05': {'USD': 27.5022, 'RUR': 1, 'EUR': 40.8078, 'KZT': 0.18886299999999998, 'UAH': 3.4528799999999995, 'BYR': 0.00912482}, '2011-06': {'USD': 27.9805, 'RUR': 1, 'EUR': 40.2444, 'KZT': 0.19240500000000002, 'UAH': 3.50655, 'BYR': 0.00562083}, '2011-07': {'USD': 27.8726, 'RUR': 1, 'EUR': 40.4153, 'KZT': 0.19110499999999997, 'UAH': 3.48909, 'BYR': 0.005613819999999999}, '2011-08': {'USD': 27.6796, 'RUR': 1, 'EUR': 39.5182, 'KZT': 0.18913900000000003, 'UAH': 3.4612499999999997, 'BYR': 0.00559071}, '2011-09': {'USD': 28.9278, 'RUR': 1, 'EUR': 41.7631, 'KZT': 0.19733799999999999, 'UAH': 3.62005, 'BYR': 0.00567546}, '2011-10': {'USD': 32.11, 'RUR': 1, 'EUR': 43.4191, 'KZT': 0.216864, 'UAH': 4.015610000000001, 'BYR': 0.00569326}, '2011-11': {'USD': 30.1245, 'RUR': 1, 'EUR': 42.1833, 'KZT': 0.20384, 'UAH': 3.76321, 'BYR': 0.0035440600000000004}, '2011-12': {'USD': 31.4001, 'RUR': 1, 'EUR': 41.7559, 'KZT': 0.212572, 'UAH': 3.91498, 'BYR': 0.0036511699999999996}, '2012-01': {'USD': 32.1961, 'RUR': 1, 'EUR': 41.6714, 'KZT': 0.216874, 'UAH': 4.00549, 'BYR': 0.00385582}, '2012-02': {'USD': 30.3131, 'RUR': 1, 'EUR': 39.9678, 'KZT': 0.204039, 'UAH': 3.7731000000000003, 'BYR': 0.00362164}, '2012-03': {'USD': 29.0253, 'RUR': 1, 'EUR': 39.1029, 'KZT': 0.196475, 'UAH': 3.63066, 'BYR': 0.00359669}, '2012-04': {'USD': 29.3282, 'RUR': 1, 'EUR': 39.1707, 'KZT': 0.198371, 'UAH': 3.65165, 'BYR': 0.00363423}, '2012-05': {'USD': 29.3627, 'RUR': 1, 'EUR': 38.9203, 'KZT': 0.19871200000000003, 'UAH': 3.6547600000000005, 'BYR': 0.00364754}, '2012-06': {'USD': 32.9173, 'RUR': 1, 'EUR': 40.8076, 'KZT': 0.222347, 'UAH': 4.07367, 'BYR': 0.00394219}, '2012-07': {'USD': 32.8169, 'RUR': 1, 'EUR': 41.323, 'KZT': 0.21962099999999998, 'UAH': 4.062250000000001, 'BYR': 0.00393488}, '2012-08': {'USD': 32.2058, 'RUR': 1, 'EUR': 39.5101, 'KZT': 0.21467, 'UAH': 3.97735, 'BYR': 0.0039037300000000002}, '2012-09': {'USD': 32.5669, 'RUR': 1, 'EUR': 40.7249, 'KZT': 0.21762, 'UAH': 4.010949999999999, 'BYR': 0.0038724}, '2012-10': {'USD': 30.9169, 'RUR': 1, 'EUR': 39.9786, 'KZT': 0.205982, 'UAH': 3.79442, 'BYR': 0.00366314}, '2012-11': {'USD': 31.3743, 'RUR': 1, 'EUR': 40.6548, 'KZT': 0.208052, 'UAH': 3.83643, 'BYR': 0.00367811}, '2012-12': {'USD': 30.811, 'RUR': 1, 'EUR': 40.0759, 'KZT': 0.204697, 'UAH': 3.7621200000000004, 'BYR': 0.00359103}, '2013-01': {'USD': 30.3727, 'RUR': 1, 'EUR': 40.2286, 'KZT': 0.20210699999999998, 'UAH': 3.7590000000000003, 'BYR': 0.0035337600000000004}, '2013-02': {'USD': 30.0161, 'RUR': 1, 'EUR': 40.7138, 'KZT': 0.19898, 'UAH': 3.69429, 'BYR': 0.0034781100000000004}, '2013-03': {'USD': 30.5124, 'RUR': 1, 'EUR': 40.1024, 'KZT': 0.202936, 'UAH': 3.74477, 'BYR': 0.00354178}, '2013-04': {'USD': 31.0834, 'RUR': 1, 'EUR': 39.8023, 'KZT': 0.20600000000000002, 'UAH': 3.8162599999999998, 'BYR': 0.00358104}, '2013-05': {'USD': 31.0433, 'RUR': 1, 'EUR': 40.6264, 'KZT': 0.20531300000000002, 'UAH': 3.82189, 'BYR': 0.0035971400000000004}, '2013-06': {'USD': 31.7979, 'RUR': 1, 'EUR': 41.4486, 'KZT': 0.209922, 'UAH': 3.9044600000000003, 'BYR': 0.00365914}, '2013-07': {'USD': 32.709, 'RUR': 1, 'EUR': 42.718, 'KZT': 0.215673, 'UAH': 4.010669999999999, 'BYR': 0.00372116}, '2013-08': {'USD': 33.033, 'RUR': 1, 'EUR': 43.7786, 'KZT': 0.21516400000000002, 'UAH': 4.0676000000000005, 'BYR': 0.00371366}, '2013-09': {'USD': 33.2474, 'RUR': 1, 'EUR': 44.0129, 'KZT': 0.216899, 'UAH': 4.093249999999999, 'BYR': 0.00368801}, '2013-10': {'USD': 32.4839, 'RUR': 1, 'EUR': 43.8143, 'KZT': 0.21120899999999998, 'UAH': 3.9658, 'BYR': 0.0035677}, '2013-11': {'USD': 32.0758, 'RUR': 1, 'EUR': 43.9406, 'KZT': 0.208014, 'UAH': 3.9176499999999996, 'BYR': 0.0034657800000000003}, '2013-12': {'USD': 33.1916, 'RUR': 1, 'EUR': 45.187, 'KZT': 0.215663, 'UAH': 4.0443, 'BYR': 0.0035499000000000004}, '2014-01': {'USD': 32.6587, 'RUR': 1, 'EUR': 45.0559, 'KZT': 0.21175999999999998, 'UAH': 3.9634300000000002, 'BYR': 0.0034233400000000004}, '2014-02': {'USD': 35.18, 'RUR': 1, 'EUR': 47.6408, 'KZT': 0.22623100000000002, 'UAH': 4.1856, 'BYR': 0.00364182}, '2014-03': {'USD': 36.1847, 'RUR': 1, 'EUR': 49.5839, 'KZT': 0.196347, 'UAH': 3.3817500000000003, 'BYR': 0.0036942}, '2014-04': {'USD': 35.6053, 'RUR': 1, 'EUR': 48.968, 'KZT': 0.195537, 'UAH': 3.16492, 'BYR': 0.00360013}, '2014-05': {'USD': 35.7227, 'RUR': 1, 'EUR': 49.3188, 'KZT': 0.196219, 'UAH': 3.11989, 'BYR': 0.0035758499999999998}, '2014-06': {'USD': 34.7352, 'RUR': 1, 'EUR': 47.2677, 'KZT': 0.189303, 'UAH': 2.94366, 'BYR': 0.0034459499999999997}, '2014-07': {'USD': 33.8434, 'RUR': 1, 'EUR': 46.1827, 'KZT': 0.184418, 'UAH': 2.88029, 'BYR': 0.00331798}, '2014-08': {'USD': 35.4438, 'RUR': 1, 'EUR': 47.4699, 'KZT': 0.19364, 'UAH': 2.89692, 'BYR': 0.0034344799999999997}, '2014-09': {'USD': 36.9316, 'RUR': 1, 'EUR': 48.6315, 'KZT': 0.20291, 'UAH': 2.73567, 'BYR': 0.0035409}, '2014-10': {'USD': 39.3836, 'RUR': 1, 'EUR': 49.9817, 'KZT': 0.21647099999999997, 'UAH': 3.0412, 'BYR': 0.0037119300000000004}, '2014-11': {'USD': 41.9627, 'RUR': 1, 'EUR': 52.7219, 'KZT': 0.232011, 'UAH': 3.2272799999999995, 'BYR': 0.00391078}, '2014-12': {'USD': 49.322, 'RUR': 1, 'EUR': 61.4108, 'KZT': 0.272542, 'UAH': 3.2831, 'BYR': 0.00453327}, '2015-01': {'USD': 56.2376, 'RUR': 1, 'EUR': 68.3681, 'KZT': 0.308143, 'UAH': 3.55525, 'BYR': 0.00387846}, '2015-02': {'USD': 68.9291, 'RUR': 1, 'EUR': 78.1105, 'KZT': 0.37371099999999996, 'UAH': 4.32993, 'BYR': 0.0044100499999999996}, '2015-03': {'USD': 61.2718, 'RUR': 1, 'EUR': 68.6857, 'KZT': 0.330663, 'UAH': 2.07701, 'BYR': 0.00409845}, '2015-04': {'USD': 57.65, 'RUR': 1, 'EUR': 62.0487, 'KZT': 0.310447, 'UAH': 2.45842, 'BYR': 0.00392177}, '2015-05': {'USD': 51.1388, 'RUR': 1, 'EUR': 57.1578, 'KZT': 0.275236, 'UAH': 2.40653, 'BYR': 0.00358366}, '2015-06': {'USD': 52.9716, 'RUR': 1, 'EUR': 58.0145, 'KZT': 0.28485499999999997, 'UAH': 2.5105, 'BYR': 0.0035611199999999997}, '2015-07': {'USD': 55.8413, 'RUR': 1, 'EUR': 62.3803, 'KZT': 0.299883, 'UAH': 2.65911, 'BYR': 0.00365813}, '2015-08': {'USD': 60.3458, 'RUR': 1, 'EUR': 66.0002, 'KZT': 0.321947, 'UAH': 2.85323, 'BYR': 0.0039649}, '2015-09': {'USD': 66.7152, 'RUR': 1, 'EUR': 74.8478, 'KZT': 0.27856000000000003, 'UAH': 3.06737, 'BYR': 0.00383862}, '2015-10': {'USD': 65.7364, 'RUR': 1, 'EUR': 73.776, 'KZT': 0.242588, 'UAH': 3.08549, 'BYR': 0.00371917}, '2015-11': {'USD': 64.3742, 'RUR': 1, 'EUR': 70.7537, 'KZT': 0.229859, 'UAH': 2.7928100000000002, 'BYR': 0.0036901200000000003}, '2015-12': {'USD': 66.737, 'RUR': 1, 'EUR': 70.6478, 'KZT': 0.216996, 'UAH': 2.80998, 'BYR': 0.0036957}, '2016-01': {'USD': 72.9299, 'RUR': 1, 'EUR': 79.6395, 'KZT': 0.213821, 'UAH': 3.0352, 'BYR': 0.0039041699999999998}, '2016-02': {'USD': 75.1723, 'RUR': 1, 'EUR': 81.9077, 'KZT': 0.206961, 'UAH': 2.95954, 'BYR': 0.00360971}, '2016-03': {'USD': 75.8994, 'RUR': 1, 'EUR': 83.1023, 'KZT': 0.21701, 'UAH': 2.80072, 'BYR': 0.00353185}, '2016-04': {'USD': 67.8552, 'RUR': 1, 'EUR': 76.9207, 'KZT': 0.19741399999999998, 'UAH': 2.5849599999999997, 'BYR': 0.00336834}, '2016-05': {'USD': 64.3334, 'RUR': 1, 'EUR': 73.3015, 'KZT': 0.196618, 'UAH': 2.55291, 'BYR': 0.0033472099999999998}, '2016-06': {'USD': 65.9962, 'RUR': 1, 'EUR': 73.4406, 'KZT': 0.19654, 'UAH': 2.62358, 'BYR': 0.00333483}, '2016-07': {'USD': 64.1755, 'RUR': 1, 'EUR': 71.2926, 'KZT': 0.189448, 'UAH': 2.5846, 'BYR': None}, '2016-08': {'USD': 67.0512, 'RUR': 1, 'EUR': 74.3799, 'KZT': 0.190273, 'UAH': 2.70368, 'BYR': None}, '2016-09': {'USD': 65.2535, 'RUR': 1, 'EUR': 72.6859, 'KZT': 0.19169899999999998, 'UAH': 2.50013, 'BYR': None}, '2016-10': {'USD': 63.396, 'RUR': 1, 'EUR': 70.9338, 'KZT': 0.188946, 'UAH': 2.44348, 'BYR': None}, '2016-11': {'USD': 63.2174, 'RUR': 1, 'EUR': 69.2863, 'KZT': 0.188664, 'UAH': 2.47911, 'BYR': None}, '2016-12': {'USD': 65.2382, 'RUR': 1, 'EUR': 69.3417, 'KZT': 0.19091999999999998, 'UAH': 2.54837, 'BYR': None}, '2017-01': {'USD': 60.6569, 'RUR': 1, 'EUR': 63.8111, 'KZT': 0.181637, 'UAH': 2.23826, 'BYR': None}, '2017-02': {'USD': 60.0851, 'RUR': 1, 'EUR': 64.285, 'KZT': 0.18574300000000002, 'UAH': 2.2163399999999998, 'BYR': None}, '2017-03': {'USD': 57.9627, 'RUR': 1, 'EUR': 61.3883, 'KZT': 0.18537700000000001, 'UAH': 2.13333, 'BYR': None}, '2017-04': {'USD': 55.9606, 'RUR': 1, 'EUR': 59.8107, 'KZT': 0.178432, 'UAH': 2.0707, 'BYR': None}, '2017-05': {'USD': 56.9838, 'RUR': 1, 'EUR': 62.044, 'KZT': 0.181226, 'UAH': 2.14669, 'BYR': None}, '2017-06': {'USD': 56.6876, 'RUR': 1, 'EUR': 63.4107, 'KZT': 0.181531, 'UAH': 2.1548100000000003, 'BYR': None}, '2017-07': {'USD': 59.3862, 'RUR': 1, 'EUR': 67.8072, 'KZT': 0.183719, 'UAH': 2.28058, 'BYR': None}, '2017-08': {'USD': 60.0633, 'RUR': 1, 'EUR': 70.4603, 'KZT': 0.18218399999999998, 'UAH': 2.32308, 'BYR': None}, '2017-09': {'USD': 58.5454, 'RUR': 1, 'EUR': 69.6222, 'KZT': 0.173291, 'UAH': 2.2767, 'BYR': None}, '2017-10': {'USD': 58.0169, 'RUR': 1, 'EUR': 68.4483, 'KZT': 0.170075, 'UAH': 2.1815, 'BYR': None}, '2017-11': {'USD': 58.1179, 'RUR': 1, 'EUR': 67.6434, 'KZT': 0.17363900000000002, 'UAH': 2.16373, 'BYR': None}, '2017-12': {'USD': 58.5814, 'RUR': 1, 'EUR': 69.5185, 'KZT': 0.176847, 'UAH': 2.1565000000000003, 'BYR': None}, '2018-01': {'USD': 57.6002, 'RUR': 1, 'EUR': 68.8668, 'KZT': 0.173184, 'UAH': 2.04955, 'BYR': None}, '2018-02': {'USD': 56.184, 'RUR': 1, 'EUR': 69.9322, 'KZT': 0.17416, 'UAH': 2.0181, 'BYR': None}, '2018-03': {'USD': 56.3742, 'RUR': 1, 'EUR': 68.9062, 'KZT': 0.17596299999999998, 'UAH': 2.10351, 'BYR': None}, '2018-04': {'USD': 57.2649, 'RUR': 1, 'EUR': 70.5618, 'KZT': 0.17982900000000002, 'UAH': 2.1761299999999997, 'BYR': None}, '2018-05': {'USD': 61.9997, 'RUR': 1, 'EUR': 75.2056, 'KZT': 0.189546, 'UAH': 2.36369, 'BYR': None}, '2018-06': {'USD': 62.0188, 'RUR': 1, 'EUR': 72.5806, 'KZT': 0.188281, 'UAH': 2.37483, 'BYR': None}, '2018-07': {'USD': 62.7565, 'RUR': 1, 'EUR': 72.9921, 'KZT': 0.183843, 'UAH': 2.38527, 'BYR': None}, '2018-08': {'USD': 62.3497, 'RUR': 1, 'EUR': 73.0738, 'KZT': 0.17957599999999999, 'UAH': 2.3199899999999998, 'BYR': None}, '2018-09': {'USD': 68.0447, 'RUR': 1, 'EUR': 79.4966, 'KZT': 0.187126, 'UAH': 2.4086600000000002, 'BYR': None}, '2018-10': {'USD': 65.5906, 'RUR': 1, 'EUR': 76.2294, 'KZT': 0.180626, 'UAH': 2.32056, 'BYR': None}, '2018-11': {'USD': 65.5962, 'RUR': 1, 'EUR': 74.4189, 'KZT': 0.17775300000000002, 'UAH': 2.3348, 'BYR': None}, '2018-12': {'USD': 66.5335, 'RUR': 1, 'EUR': 75.7484, 'KZT': 0.178169, 'UAH': 2.35508, 'BYR': None}, '2019-01': {'USD': 69.4706, 'RUR': 1, 'EUR': 79.4605, 'KZT': 0.18056999999999998, 'UAH': 2.50706, 'BYR': None}, '2019-02': {'USD': 65.3577, 'RUR': 1, 'EUR': 75.2006, 'KZT': 0.171867, 'UAH': 2.35499, 'BYR': None}, '2019-03': {'USD': 65.8895, 'RUR': 1, 'EUR': 74.9691, 'KZT': 0.17573799999999998, 'UAH': 2.45673, 'BYR': None}, '2019-04': {'USD': 64.7347, 'RUR': 1, 'EUR': 72.723, 'KZT': 0.170498, 'UAH': 2.38008, 'BYR': None}, '2019-05': {'USD': 64.6314, 'RUR': 1, 'EUR': 72.3096, 'KZT': 0.169558, 'UAH': 2.44839, 'BYR': None}, '2019-06': {'USD': 65.3834, 'RUR': 1, 'EUR': 72.8436, 'KZT': 0.170928, 'UAH': 2.4333, 'BYR': None}, '2019-07': {'USD': 63.0756, 'RUR': 1, 'EUR': 71.8179, 'KZT': 0.16575900000000002, 'UAH': 2.41161, 'BYR': None}, '2019-08': {'USD': 63.4172, 'RUR': 1, 'EUR': 70.7355, 'KZT': 0.164966, 'UAH': 2.53276, 'BYR': None}, '2019-09': {'USD': 66.4897, 'RUR': 1, 'EUR': 73.3847, 'KZT': 0.171686, 'UAH': 2.6458500000000003, 'BYR': None}, '2019-10': {'USD': 64.6407, 'RUR': 1, 'EUR': 70.7169, 'KZT': 0.166503, 'UAH': 2.67497, 'BYR': None}, '2019-11': {'USD': 63.7748, 'RUR': 1, 'EUR': 71.1918, 'KZT': 0.164083, 'UAH': 2.56843, 'BYR': None}, '2019-12': {'USD': 64.0817, 'RUR': 1, 'EUR': 70.5475, 'KZT': 0.165875, 'UAH': 2.67341, 'BYR': None}, '2020-01': {'USD': 61.9057, 'RUR': 1, 'EUR': 69.3777, 'KZT': 0.161665, 'UAH': 2.61205, 'BYR': None}, '2020-02': {'USD': 63.1385, 'RUR': 1, 'EUR': 69.5976, 'KZT': 0.16653700000000002, 'UAH': 2.5229600000000003, 'BYR': None}, '2020-03': {'USD': 66.9909, 'RUR': 1, 'EUR': 73.7235, 'KZT': 0.17554099999999997, 'UAH': 2.7257000000000002, 'BYR': None}, '2020-04': {'USD': 77.7325, 'RUR': 1, 'EUR': 85.7389, 'KZT': 0.17427800000000002, 'UAH': 2.75213, 'BYR': None}, '2020-05': {'USD': 72.7263, 'RUR': 1, 'EUR': 79.1189, 'KZT': 0.171298, 'UAH': 2.6979800000000003, 'BYR': None}, '2020-06': {'USD': 70.752, 'RUR': 1, 'EUR': 78.5489, 'KZT': 0.17164300000000002, 'UAH': 2.62872, 'BYR': None}, '2020-07': {'USD': 70.4413, 'RUR': 1, 'EUR': 78.9929, 'KZT': 0.174099, 'UAH': 2.64194, 'BYR': None}, '2020-08': {'USD': 73.4261, 'RUR': 1, 'EUR': 87.2889, 'KZT': 0.174086, 'UAH': 2.65196, 'BYR': None}, '2020-09': {'USD': 73.8039, 'RUR': 1, 'EUR': 87.8266, 'KZT': 0.175623, 'UAH': 2.67537, 'BYR': None}, '2020-10': {'USD': 78.7847, 'RUR': 1, 'EUR': 92.4302, 'KZT': 0.18199500000000002, 'UAH': 2.78337, 'BYR': None}, '2020-11': {'USD': 79.3323, 'RUR': 1, 'EUR': 92.6284, 'KZT': 0.183154, 'UAH': 2.78971, 'BYR': None}, '2020-12': {'USD': 76.1999, 'RUR': 1, 'EUR': 91.2037, 'KZT': 0.179066, 'UAH': 2.67321, 'BYR': None}, '2021-01': {'USD': 73.8757, 'RUR': 1, 'EUR': 90.7932, 'KZT': 0.17525200000000002, 'UAH': 2.60711, 'BYR': None}, '2021-02': {'USD': 76.2527, 'RUR': 1, 'EUR': 92.2963, 'KZT': 0.179782, 'UAH': 2.7094, 'BYR': None}, '2021-03': {'USD': 74.4373, 'RUR': 1, 'EUR': 90.3743, 'KZT': 0.17825500000000002, 'UAH': 2.66296, 'BYR': None}, '2021-04': {'USD': 75.6373, 'RUR': 1, 'EUR': 88.7452, 'KZT': 0.17780100000000001, 'UAH': 2.71942, 'BYR': None}, '2021-05': {'USD': 74.8451, 'RUR': 1, 'EUR': 90.585, 'KZT': 0.174178, 'UAH': 2.69783, 'BYR': None}, '2021-06': {'USD': 73.2965, 'RUR': 1, 'EUR': 89.3778, 'KZT': 0.170912, 'UAH': 2.66893, 'BYR': None}, '2021-07': {'USD': 72.7234, 'RUR': 1, 'EUR': 86.5118, 'KZT': 0.16977799999999998, 'UAH': 2.67074, 'BYR': None}, '2021-08': {'USD': 73.1388, 'RUR': 1, 'EUR': 86.9913, 'KZT': 0.171891, 'UAH': 2.7271799999999997, 'BYR': None}, '2021-09': {'USD': 73.2781, 'RUR': 1, 'EUR': 86.666, 'KZT': 0.17175200000000002, 'UAH': 2.72558, 'BYR': None}, '2021-10': {'USD': 72.6642, 'RUR': 1, 'EUR': 84.305, 'KZT': 0.170653, 'UAH': 2.7288699999999997, 'BYR': None}, '2021-11': {'USD': 70.52, 'RUR': 1, 'EUR': 82.2898, 'KZT': 0.16494, 'UAH': 2.68152, 'BYR': None}, '2021-12': {'USD': 74.8926, 'RUR': 1, 'EUR': 84.8234, 'KZT': 0.170443, 'UAH': 2.74319, 'BYR': None}, '2022-01': {'USD': 74.2926, 'RUR': 1, 'EUR': 84.0695, 'KZT': 0.16899999999999998, 'UAH': 2.7258400000000003, 'BYR': None}, '2022-02': {'USD': 77.4702, 'RUR': 1, 'EUR': 86.5032, 'KZT': 0.178379, 'UAH': 2.71136, 'BYR': None}, '2022-03': {'USD': 93.5589, 'RUR': 1, 'EUR': 104.4772, 'KZT': 0.188393, 'UAH': 3.10053, 'BYR': None}, '2022-04': {'USD': 83.4097, 'RUR': 1, 'EUR': 92.493, 'KZT': 0.177349, 'UAH': 2.82427, 'BYR': None}, '2022-05': {'USD': 71.0237, 'RUR': 1, 'EUR': 74.5589, 'KZT': 0.158362, 'UAH': 2.34698, 'BYR': None}, '2022-06': {'USD': 61.6069, 'RUR': 1, 'EUR': 62.7397, 'KZT': 0.144147, 'UAH': 2.0778, 'BYR': None}, '2022-07': {'USD': 52.5123, 'RUR': 1, 'EUR': 54.6405, 'KZT': 0.11291000000000001, 'UAH': 1.77865, 'BYR': None}}
    print(data_currency)
    create_dataframe(dataframe, data_currency)


def create_dataframe(data, data_currency):
    """
    Записывает отформатированные данные в csv формат
        data(list): данные о вакансиях
        data_currency(dict): данные о курсах валют по года
    Returns:
         list: отформатированые данные
    """
    dataframe = [['name', 'salary', 'area_name', 'published_at']]
    flag = 0
    for row in data:
        if flag == 100:
            break
        flag += 1
        vacancy = [row[0]]
        try:
            cof = data_currency[row[5][:7]][row[3]]
        except Exception:
            cof = 1
        if cof == None:
            vacancy.append([None, row[5], row[4]])
            continue
        if row[1] == '' and row[2] != '':
            vacancy.append(round((float(row[2]) * cof), 1))
        elif row[1] != '' and row[2] == '':
            vacancy.append(round((float(row[1]) * cof), 1))
        elif row[1] != '' and row[2] != '':
            vacancy.append(round(((float(row[2]) + float(row[2])) * cof / 2), 1))
        else:
            vacancy.append(None)
        vacancy.append(row[4])
        vacancy.append(row[5])
        dataframe.append(vacancy)
    with open(f"F:/Makarov/3_3_2.csv", "w", newline="", encoding='utf-8-sig') as f:
        writer = csv.writer(f)
        writer.writerows(dataframe)
    return dataframe


def create_csv(dict_currencies_new, min_date, max_date):
    """
    Создает и записывает в csv файл данные по валютам с сайта ЦБ РФ,
    и возврашает их в виде словаря с датами в качестве ключей
    Args:
        dict_currencies_new(dict): словарь с валютами
        min_date(datetime): самая рання записаь
        max_date(datetime):  самая поздняя запись
    Returns:
        dict: данные о валютах по датам
    """
    data_currency = {}
    with open(f"F:/Makarov/currency_api.csv", "w", newline="", encoding='utf-8-sig') as f:
        writer = csv.writer(f)
        writer.writerow(dict_currencies_new.keys())
        for date in pd.date_range(start=min_date.strftime('%Y-%m-%d'),
                                  end=(max_date + timedelta(days=30)).strftime('%Y-%m-%d'), freq='M'):
            info = make_request([date.strftime('%m'), date.year])
            for key in dict_currencies_new.keys():
                try:
                    dict_currencies_new[key] = info[key]
                except Exception:
                    dict_currencies_new[key] = None
                dict_currencies_new['RUR'] = 1
                dict_currencies_new['date'] = date.strftime('%Y-%m')
            data_currency[dict_currencies_new['date']] = dict_currencies_new.copy()
            data_currency[dict_currencies_new['date']].pop('date')
            writer.writerow(dict_currencies_new.values())
    return data_currency


def make_request(date):
    """
    Отправляет api запрос на www.cbr.ru
    Args:
        date(lis): месяц и год для api запроса
    Returns:
        dict: словарь с вакансиями и их ценой к рублю
    """
    response = requests.get(f'http://www.cbr.ru/scripts/XML_daily.asp?date_req=01/{date[0]}/{date[1]}')
    tree = ET.fromstring(response.content)
    currencies = {}
    for child in tree.findall('Valute'):
        currencies[child.find('CharCode').text] = float(child.find('Value').text.replace(',', '.')) / float(
            child.find('Nominal').text.replace(',', '.'))
    return currencies


def parser_csv(name):
    """
    Читате переданный csv файл
    Args:
        name(str): имя фала для считывания
    Returns:
        dict_currencies_new(dict): словарь с валютами
        min_date(datetime): самая рання записаь
        max_date(datetime):  самая поздняя запись
    """
    min_date = datetime.now()
    max_date = DataSet.format_time3('2000-07-14T11:06:59+0300')
    dict_currencies = {}
    dataframe = []
    with open(name, encoding='utf-8-sig') as file:
        reader = csv.reader(file)
        heading = next(reader)
        for row in reader:
            dataframe.append(row)
            date = DataSet.format_time3(row[5])
            min_date = date if (date.timestamp() < min_date.timestamp()) else min_date
            max_date = date if (date.timestamp() > min_date.timestamp()) else max_date
            if dict_currencies.__contains__(row[3]):
                dict_currencies[row[3]] += 1
            else:
                dict_currencies[row[3]] = 0
    return min_date, max_date, dict_currencies, dataframe


if __name__ == "__main__":
    main()
